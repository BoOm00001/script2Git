#!/bin/bash

# Mot de passe administrateur par défaut
MDPADMIN="admin24"

# Demande le nom de l'utilisateur
echo "Entrez le nom de l'utilisateur à créer :"
read NOM_UTILISATEUR

# Demande le nom du poste de travail
echo "Entrez le nom de votre poste de travail :"
read NOM_POSTE_DE_TRAVAIL

# Vérifie si l'utilisateur existe déjà
while grep -q "^$NOM_UTILISATEUR:" /etc/passwd; do
    echo "L'utilisateur $NOM_UTILISATEUR existe déjà, veuillez choisir un autre nom :"
    read NOM_UTILISATEUR
done

<<<<<<< HEAD
# Création de l'utilisateur sans mot de passe
echo "$MDPADMIN " | sudo adduser --quiet --disabled-password --gecos "" --allow-bad-names "$NOM_UTILISATEUR"

# Crée un répertoire de bienvenue dans le dossier personnel de l'utilisateur
UTILISATEUR_HOME="/home/$NOM_UTILISATEUR/Bienvenue"
echo "$MDPADMIN" | sudo mkdir -p "$UTILISATEUR_HOME"
echo "$MDPADMIN" |sudo touch "$UTILISATEUR_HOME/fichier.txt"

# Changer le propriétaire et définir les permissions
echo "$MDPADMIN" |sudo chown -R "$NOM_UTILISATEUR:$NOM_UTILISATEUR" "$UTILISATEUR_HOME"
echo "$MDPADMIN" |sudo chmod 700 "$UTILISATEUR_HOME"
=======
# Création de l'utilisateur avec un mot de passe par défaut
sudo adduser --quiet --disabled-password --gecos "" "$NOM_UTILISATEUR"
echo "$NOM_UTILISATEUR:$MDPADMIN" | sudo chpasswd

# Définition des chemins
UTILISATEUR_HOME="/home/$NOM_UTILISATEUR"
BIENVENUE_DIR="$UTILISATEUR_HOME/Bienvenue"
FICHIER_BIENVENUE="$BIENVENUE_DIR/fichier.txt"

# Création du répertoire de bienvenue
sudo mkdir -p "$BIENVENUE_DIR"
sudo touch "$FICHIER_BIENVENUE"
>>>>>>> 91f0b4fecf08ba04916f3e9a2d740cea7e44de87

# Changer les permissions pour restreindre l'accès au propriétaire
sudo chown -R "$NOM_UTILISATEUR:$NOM_UTILISATEUR" "$BIENVENUE_DIR"
sudo chmod 700 "$BIENVENUE_DIR"
sudo chmod 600 "$FICHIER_BIENVENUE"

# Écrire des informations dans le fichier de bienvenue
echo "Bienvenue $NOM_UTILISATEUR sur ton nouveau poste de travail $NOM_POSTE_DE_TRAVAIL." | sudo tee "$FICHIER_BIENVENUE" > /dev/null
echo "Ton répertoire de travail est : $BIENVENUE_DIR, avec des droits restreints au propriétaire." | sudo tee -a "$FICHIER_BIENVENUE" > /dev/null
echo "Adresse IP de la machine :" | sudo tee -a "$FICHIER_BIENVENUE" > /dev/null
ip -4 addr show | grep "inet" | awk '{print $2}' | cut -d/ -f1 | sudo tee -a "$FICHIER_BIENVENUE" > /dev/null

# Message de confirmation
echo "Utilisateur $NOM_UTILISATEUR créé avec succès."
echo "Le répertoire de bienvenue et les informations associées ont été configurés."

<<<<<<< HEAD
# Affichage du contenu de fichier.txt
sudo cat "$UTILISATEUR_HOME/fichier.txt"
 
=======
# Afficher le contenu du fichier de bienvenue
cat "$FICHIER_BIENVENUE"
>>>>>>> 91f0b4fecf08ba04916f3e9a2d740cea7e44de87
